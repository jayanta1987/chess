<!DOCTYPE html>
<html>
<head>
<title></title>
<meta charset="UTF-8">
<style>
.chess-board {
	border-spacing: 0;
	border-collapse: collapse;
}

.chess-board th {
	padding: .5em;
}

.chess-board td {
	border: 2px solid;
	width: 6em;
	height: 6em;
	text-align: center;
}

.chess-board .light {
	background: #eee;
	color: #b3b3b3;
}

.chess-board .movable {
	border: 2px solid #00ff40;
}

.chess-board .movable img {
	width: 48px;
}

.chess-board .selected {
	border: 2px solid #3bfff2;
}

.chess-board .dark {
	background: #70818e;
	color: #fff;
}
</style>
<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

<script th:inline="javascript">
	function getData(piecetype, xNum, yNum, color) {

		$("td").removeClass("selected movable");
		$("#id" + xNum + '' + yNum).addClass("selected");

		request = {
			piecetype : piecetype,
			currentLocation : {
				xNum : xNum,
				yNum : yNum
			},
			color : color
		};

		$.ajax({
					type : 'POST',
					url : '/checkmoves',
					data : JSON.stringify(request),
					dataType : "json",
					contentType : "application/json; charset=utf-8",
					success : function(response) {
						$.each(response.possibleMoves, function(k, v) {
								$("#id" + v.xNum + '' + v.yNum).addClass("movable");
								htmlval = $("#id" + v.xNum + '' + v.yNum).html();
								//console.log(htmlval.trim());
								
								newAttr = "return movehere(this,'"+piecetype+"',"+v.xNum+","+v.yNum+",'"+color+"',"+xNum+", "+yNum+")";
								
								if (htmlval.trim() == null
										|| htmlval.trim() == "") {
									$("#id" + v.xNum + '' + v.yNum)
											.html('<a href="#'+ v.xNum + '' + v.yNum+'" onclick="'+newAttr+'"><img src="blank.png" width="48px" /></a>');
								}else{
									$("#id" + v.xNum + '' + v.yNum).find('a').attr("onclick", newAttr);
								}
							});
					}
				});

	}
</script>

<script th:inline="javascript">
function movehere(curr,piecetype,xNum,yNum,color, fromXNum, fromYNum){
	console.log("Moving  to "+xNum+","+yNum+" with "+color+" "+piecetype+" from "+fromXNum+","+fromYNum+".");
	return false;
}
</script>

</head>
<body>
	<h1 align="center" style="color: #1b2e3c">Chess Master</h1>
	<div id="fill"></div>
	<table class="chess-board" align="center">
		<tbody>
			<tr th:each="row : ${board}">
				<td th:each="cell: ${row}" th:class="${cell.cssClass}"
					th:id="'id' + ${cell.xNum} + ${cell.yNum}"><a
					th:href="@{'#' + ${cell.xNum} + ${cell.yNum}}"
					th:attr="onclick=|getData('${cell.occupyingPiece.pieceType}', ${cell.xNum}, ${cell.yNum}, '${cell.occupyingPiece.color}')|"
					th:if="${cell.occupyingPiece != null}"><img
						th:src="${cell.occupyingPiece.imgName}" /></a></td>
			</tr>
		</tbody>
	</table>
</body>
</html>